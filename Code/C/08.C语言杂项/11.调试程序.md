# 调试程序

开发程序都会遇到各种各样的bug，bug并不是编译错误，在开发过程中编译错误都容易解决，最不好解决的是程序能编译通过，但是无法得到正确运行结果的bug。

小的bug可能导致程序运行不顺畅，大的bug可能就会直接导致程序跑飞、死机，显然我们要把这些bug干掉，干掉Bug就是“程序调试”要干的事情，所以在程序开发的过程中，程序调试是非常重要的。

## 调试手段

调试手段总体而言可以分为以下几种：

- 打印调试
- 单步调试
- 硬件调试
- log文件调试

## 打印调试

利用printf打印关键信息，然后通过这些关键信息来判断代码可能的问题。

**打印调试的优点**

- 打印调试简单易行，而且很直接、很直观，是程序员最为常用的调试方式。

**打印调试的缺点**

- 打印调试太少了可能找不出问题，但是太多了又有可能会淹没有用信息，不好把握。
- 打印调试不如“单步调试”精确，显示的调试信息也不如“单步调试”丰富。

## 单步调试

编译器集合会提供“debug调试程序”（调试命令），比如gcc编译器集合就会提供debug调试程序（gdb）

**命令行运行gdb**

- 编译时，在程序中包含调试信息：`gcc a.c -g`
- 使用gdb命令调试程序：`gdb a.out`

**IDE调用gdb程序进行调试**

- 创建debug工程，此时编译器会自动加上-g选项
- 使用界面按钮进行单步调试

**gdb简单使用**

- 设置断点命令b：b lineNo; b fileName:lineNo; b funName
- info b：查看所有断点信息
- 让断点失效：disable bno
- 删除断点：clear
- 运行程序：r
- 单步运行：n（下一步，遇到函数时不进入函数），s（下一步，遇到函数时进入函数）
- 查看变量：p n（变量名）
- 查看源码：l
- 结束单步调试：kill
- 退出gdb：q

单步调试的优点

- 可以提供更精细的跟踪
- 调试信息丰富，比如可以显示各个变量、寄存器的值，甚至某段c代码对应的汇编代码

单步调试的缺点

- 单步跟踪往往节奏比较慢
- 大多数情况下还是打印调试来的更方便快捷
- 遇到特别难搞定的bug时，还是会使用单步调试来精细跟踪


## 硬件调试

使用led、蜂鸣器等硬件来调试，这种调试方式常见于裸机（比如单片机）开发中。

调试方法：

```
...  //正常代码
...
驱动LED、蜂鸣器的代码
...
...
```
如果led被点亮了或者蜂鸣器鸣响了，说明前面的代码就没有问题，否则就说明前面的代码有问题

## log文件调试

og文件指的是软件程序在运行的过程中所记录的信息，log文件一般是txt文本形式，可以直接打开查看。当然也有例外。

程序在发布时不可能将所有的bug都找出来，剩余的bug只能在发布后的公测阶段来被发现，程序运行所产生的bug就会记录在日志文件中，然后就可以利用这些信息来帮助调试。

## 汇编辅助调试

面对有些非常难搞定的问题，我们有时候还可以通过查看汇编代码来辅助解决。

## 调试宏

变参调试宏
```
#ifdef DEBUG
    #define debug(fmt, args...) printf(fmt, args)
#else
    #define debug(fmt, args...)
#endif
```

- 如果定义了`DEBUG`宏，宏体为`printf`，此时`debug`有效
- 如果没有定义`DEBUG`宏，宏体为空，`debug`无效

编译时，可以使用`-D`指定预定义宏

```
$ gcc a.c b.c -DDEBUG
```
