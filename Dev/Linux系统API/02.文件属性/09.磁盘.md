# 磁盘

## 磁盘的组成

**盘片**

- 圆形金属片，和CD形状一样，不过略小，被密封在硬盘里
- 盘片的中心被固定在电机的轴上，随电机而转动
- 一个盘片有上下两个面，就像一张纸一样
- 硬盘内可以安装多个盘片

**磁头**

- 磁头用来读写盘片上的数据
- 磁头悬浮在盘面上（当盘片转动起来之后）
- 一个盘片需要配置两个磁头（上下两面读写数据）
- 磁头只能沿着盘片半径的方向移动

**磁道**

- 磁头固定不动，盘片自转一圈，磁头划过的区域就是磁道
- 磁头调整位置，更换不同的磁道

**扇区**

- 将磁道平均分成若干份，每一份就是一个扇区
- 一个扇区可以存储512字节
- 磁盘最小的存取到位就是扇区

## 磁盘的寻址方式

**CHS方式**

CHS --- Cylinder Head Sector

寻址方式：通过面、磁道、扇区的方式寻址，例如0面0磁道1扇区

CHS三元组

- 前10 bit表示cylinder（磁道）
- 中间8 bit表示head（磁头，即磁盘的面）
- 后6 bit表示secotr（扇区）

*一共24bit，可寻址8GB，后来扩展到28bit，可寻址128GB*

**LBA方式**

LBA --- Logical Block Addressing

为硬盘的每一个扇区分配一个逻辑地址编号

- 48bit地址，最大寻址128PB
- 实际执行时，LBA转换成CHS去寻址

## MBR

MBR就是磁盘0面0磁道的第一个扇区。

**MBR里面存储的内容**

MBR一共512字节

- 前446个字节存放主引导记录
- 中间64个字节存放分区表（一个分区占用16个字节）
- 最后2个字节是结束标志（55AA）

## GPT分区表

新的分区格式，支持更多分区数量、更大硬盘，分区表在磁盘收尾各存一份。

**GPT分区表格式**

```
LBA0            Protective MBR
LBA1            Primary GPT Header
LAB2 ~ LBA33    GPT分区表（每个分区占用128bit）
LBA34之后       分区
...
...
LBA-33 ~ LBA-2  GPT分区表（backup）
LBA -1          Secondary GPT Header（backup）
```

有个header的概念，用于描述后续的内容

**引导代码**

GPT分区没有了MBR，需要UEFI BIOS配合启动。此时需要创建一个UEFI专用的启动分区，存放bootloader，UEFI驱动等。
